<!-- FILE: templates/partials/transcript_editor.html (Updated and More Robust) -->

<div id="transcript-editor" class="space-y-4">
  <h2 class="text-2xl font-bold text-gray-800">Review Your Transcript</h2>
  <p class="text-sm text-gray-500">
    Clean up any transcription errors below before generating the recipe.
  </p>

  <!--
    *** THE FIX IS HERE ***
    We've added standard 'method' and 'action' attributes.
    - If HTMX loads, hx-post will take over.
    - If HTMX FAILS to load, the browser will use 'method' and 'action' as a fallback,
      ensuring the form data is POSTed to the correct endpoint.
  -->
  <form
    class="space-y-4"
    method="post"
    action="/transcripts/{{ transcript.id }}/generate-recipe"
    hx-post="/transcripts/{{ transcript.id }}/generate-recipe"
    hx-target="#output-container"
    hx-swap="innerHTML"
    hx-indicator="#spinner"
  >
    <textarea
      name="transcript_text"
      class="mt-1 block w-full h-48 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-4"
    >{{ transcript.full_text }}</textarea>

    <div class="flex items-center space-x-4">
      <button
        type="submit"
        class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg transition-transform transform hover:scale-105"
      >
        Create Recipe
      </button>

      <div id="spinner" class="htmx-indicator">
        <p class="text-gray-500">Analyzing your recipe...</p>
      </div>
    </div>
  </form>
</div>